## reml

### Purpose

The `reml` program (and its GPU-accelerated version `reml.gpu`) performs Restricted Maximum Likelihood (REML) analysis to estimate variance components for various genetic models. It reads genomic relationship matrices (GRMs) and phenotype data to partition the phenotypic variance into components attributed to different genetic (e.g., additive, dominance, epistatic, haplotype) and residual effects.

### Options

The program uses a common option parser. Options can be specified with long names (e.g., `--input`) or short names (e.g., `-i`).

*   `--input <load_name>`: Base name for input GRM files (e.g., if `load_name` is `myproject`, it will look for `myproject.g.A`, `myproject.g.D`, etc.). Default: `grm`.
*   `--pheno <col,file>`:  Specifies the phenotype file and the column to be used as the trait. Format: `<column_number>,<filepath>` (e.g., `2,phenotypes.txt`).
*   `--missing <value>`:   Defines the numerical value used to represent missing phenotypes in the phenotype file. Default: `-9999111.0`.
*   `--iterations <num>`:  Maximum number of iterations for the REML algorithm. Default: `1`. (Note: Default of 1 might be for testing; real analyses usually require more).
*   `--tol <value>`:       Convergence tolerance for changes in variance components. The algorithm stops if changes are below this threshold. Default: `1.0e-8`.
*   `--htol <value>`:      Convergence tolerance for heritability. If negative, this check is skipped. Default: `1.0e-6`.
*   `--ai_start <iteration_num>`: Specifies the iteration number at which to switch to the Average Information (AI) algorithm, which can be faster but less stable initially. If negative, AI is not used or used based on internal defaults. Default: `3`.
*   `--out/-o <save_name>`: Prefix for output files generated by the program (e.g., iteration logs, results). Default: `out`.

**Initial Variance Component Estimates:**
The following options allow providing starting values for variance components. If not specified, the program might use defaults (often 0 or small values) or estimate them.

*   `--va   <value>`: Initial additive genetic variance (e.g., for GRM ending in `.g.A`).
*   `--vd   <value>`: Initial dominance genetic variance (e.g., for `.g.D`).
*   `--ve   <value>`: Initial residual variance [always required].
*   `--vah  <value>`: Initial haplotype additive variance (e.g., for `.g.AH`).
*   `--vaa  <value>`: Initial additive x additive epistatic variance (e.g., for `.g.AA`).
*   `--vad  <value>`: Initial additive x dominance epistatic variance (e.g., for `.g.AD`).
*   `--vdd  <value>`: Initial dominance x dominance epistatic variance (e.g., for `.g.DD`).
*   `--vaaa <value>`: Initial additive x additive x additive epistatic variance (e.g., for `.g.AAA`).
*   `--vaad <value>`: Initial additive x additive x dominance epistatic variance (e.g., for `.g.AAD`).
*   `--vadd <value>`: Initial additive x dominance x dominance epistatic variance (e.g., for `.g.ADD`).
*   `--vddd <value>`: Initial dominance x dominance x dominance epistatic variance (e.g., for `.g.DDD`).

**MPI/BLACS Grid Options:**
*   `-r <num_proc_rows>`: Overrides the automatically calculated number of processor rows in the BLACS grid.
*   `-c <num_proc_cols>`: Overrides the automatically calculated number of processor columns in the BLACS grid.
*   `--blocks <size>`:    Sets the ScaLAPACK block size for matrix operations. This affects performance and memory distribution. Default: `128`.

### Example Usage

To run `reml` for a project named `cattle_study` with phenotype data in `cattle_pheno.txt` (using the 3rd column), estimate additive and dominance variance, and save outputs with the prefix `run01`:

```bash
mpirun -np 4 ./bin/reml --input cattle_study --pheno 3,cattle_pheno.txt --va 0.5 --vd 0.2 --ve 0.3 --out run01 --iterations 100
```

For GPU acceleration:
```bash
mpirun -np 4 ./bin/reml.gpu --input cattle_study --pheno 3,cattle_pheno.txt --va 0.5 --vd 0.2 --ve 0.3 --out run01 --iterations 100
```
Note: The exact GRM files used (e.g., `cattle_study.g.A`, `cattle_study.g.D`) depend on the variance components specified (e.g. `--va` implies use of `.g.A`).
